{% extends "base.html" %}

{% block title %}Dashboard - MutaSight AI{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Welcome Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow-custom" style="background: linear-gradient(135deg, #007bff, #17a2b8); border: none;">
                <div class="card-body text-white">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <h2 class="mb-2 fw-bold">Welcome back, {{ current_user.first_name or current_user.username }}!</h2>
                            <p class="mb-0">Ready to discover and analyze molecular structures with advanced 3D visualization and AI-powered insights.</p>
                        </div>
                        <div class="col-md-4 text-end">
                            <i data-feather="hexagon" style="width: 64px; height: 64px; opacity: 0.7;"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Quick Stats -->
    <div class="row mb-4">
        <div class="col-md-3 col-sm-6 mb-3">
            <div class="card shadow-hover" style="background: linear-gradient(135deg, #17a2b8, #138496); border: none;">
                <div class="card-body text-white">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h4 class="mb-0 fw-bold">{{ user_projects|length }}</h4>
                            <p class="mb-0">My Projects</p>
                        </div>
                        <div class="align-self-center">
                            <i data-feather="folder" style="width: 32px; height: 32px;"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-3 col-sm-6 mb-3">
            <div class="card shadow-hover" style="background: linear-gradient(135deg, #28a745, #20a540); border: none;">
                <div class="card-body text-white">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h4 class="mb-0 fw-bold">{{ member_projects|length }}</h4>
                            <p class="mb-0">Collaborations</p>
                        </div>
                        <div class="align-self-center">
                            <i data-feather="users" style="width: 32px; height: 32px;"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-3 col-sm-6 mb-3">
            <div class="card shadow-hover" style="background: linear-gradient(135deg, #ffc107, #e0a800); border: none;">
                <div class="card-body text-white">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h4 class="mb-0 fw-bold">{{ recent_analyses|length }}</h4>
                            <p class="mb-0">Recent Analyses</p>
                        </div>
                        <div class="align-self-center">
                            <i data-feather="hexagon" style="width: 32px; height: 32px;"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-3 col-sm-6 mb-3">
            <div class="card shadow-hover" style="background: linear-gradient(135deg, #dc3545, #c82333); border: none;">
                <div class="card-body text-white">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h4 class="mb-0 fw-bold">24/7</h4>
                            <p class="mb-0">AI Assistant</p>
                        </div>
                        <div class="align-self-center">
                            <i data-feather="cpu" style="width: 32px; height: 32px;"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Main Content Row -->
    <div class="row">
        <!-- Quick Actions -->
        <div class="col-md-4 mb-4">
            <div class="card shadow-custom">
                <div class="card-header">
                    <h5 class="mb-0"><i data-feather="zap" class="me-2"></i>Quick Actions</h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <a href="{{ url_for('main.molecular_analysis') }}" class="btn btn-outline-primary">
                            <i data-feather="hexagon" class="me-2"></i>Molecular Analysis
                        </a>
                        <a href="{{ url_for('main.dna_rna_analysis') }}" class="btn btn-outline-success">
                            <i data-feather="git-branch" class="me-2"></i>DNA/RNA Analysis
                        </a>
                        <a href="{{ url_for('main.drug_database') }}" class="btn btn-outline-info">
                            <i data-feather="database" class="me-2"></i>Drug Database
                        </a>
                        <a href="{{ url_for('main.excipients') }}" class="btn btn-outline-warning">
                            <i data-feather="tablet" class="me-2"></i>Excipients
                        </a>
                        <button class="btn btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#newProjectModal">
                            <i data-feather="plus" class="me-2"></i>New Project
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- AI Assistant Preview -->
            <div class="card mt-3 shadow-custom">
                <div class="card-header">
                    <h5 class="mb-0"><i data-feather="message-circle" class="me-2"></i>AI Assistant</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted mb-3">Ask me anything about drug discovery and molecular analysis!</p>
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Type your question..." id="quickQuestion">
                        <button class="btn btn-primary" type="button" onclick="askQuickQuestion()">
                            <i data-feather="send"></i>
                        </button>
                    </div>
                    <div id="quickAnswer" class="mt-2" style="display: none;">
                        <div class="alert alert-info mb-0">
                            <small id="answerText"></small>
                        </div>
                    </div>
                    <div class="mt-2">
                        <a href="{{ url_for('main.chat') }}" class="btn btn-sm btn-outline-primary w-100">
                            <i data-feather="external-link" class="me-1"></i>Open Full Chat
                        </a>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Recent Projects -->
        <div class="col-md-8 mb-4">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0"><i class="fas fa-project-diagram me-2"></i>Recent Projects</h5>
                    <a href="{{ url_for('main.projects') }}" class="btn btn-sm btn-outline-primary">View All</a>
                </div>
                <div class="card-body">
                    {% if user_projects or member_projects %}
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Project Name</th>
                                        <th>Role</th>
                                        <th>Status</th>
                                        <th>Last Updated</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for project in user_projects[:5] %}
                                    <tr>
                                        <td>
                                            <strong>{{ project.name }}</strong>
                                            {% if project.description %}
                                            <br><small class="text-muted">{{ project.description[:50] }}...</small>
                                            {% endif %}
                                        </td>
                                        <td><span class="badge bg-primary">Owner</span></td>
                                        <td><span class="badge bg-success">{{ project.status.title() }}</span></td>
                                        <td>{{ project.updated_at.strftime('%Y-%m-%d') }}</td>
                                        <td>
                                            <a href="{{ url_for('main.project_detail', project_id=project.id) }}" class="btn btn-sm btn-outline-primary">
                                                <i class="fas fa-eye"></i>
                                            </a>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                    
                                    {% for project in member_projects[:3] %}
                                    <tr>
                                        <td>
                                            <strong>{{ project.name }}</strong>
                                            {% if project.description %}
                                            <br><small class="text-muted">{{ project.description[:50] }}...</small>
                                            {% endif %}
                                        </td>
                                        <td><span class="badge bg-secondary">Member</span></td>
                                        <td><span class="badge bg-success">{{ project.status.title() }}</span></td>
                                        <td>{{ project.updated_at.strftime('%Y-%m-%d') }}</td>
                                        <td>
                                            <a href="{{ url_for('main.project_detail', project_id=project.id) }}" class="btn btn-sm btn-outline-primary">
                                                <i class="fas fa-eye"></i>
                                            </a>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <div class="text-center text-muted py-4">
                            <i class="fas fa-folder-open fa-3x mb-3"></i>
                            <p>No projects yet. Create your first project to get started!</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    
    <!-- Recent Molecular Analyses -->
    {% if recent_analyses %}
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0"><i class="fas fa-atom me-2"></i>Recent Molecular Analyses</h5>
                    <a href="{{ url_for('main.molecular_analysis') }}" class="btn btn-sm btn-outline-primary">New Analysis</a>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>SMILES</th>
                                    <th>Molecular Formula</th>
                                    <th>Molecular Weight</th>
                                    <th>Date</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for analysis in recent_analyses %}
                                <tr>
                                    <td><strong>{{ analysis.name }}</strong></td>
                                    <td><code>{{ analysis.smiles[:30] }}{% if analysis.smiles|length > 30 %}...{% endif %}</code></td>
                                    <td>{{ analysis.molecular_formula or 'N/A' }}</td>
                                    <td>{{ analysis.molecular_weight or 'N/A' }} g/mol</td>
                                    <td>{{ analysis.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<!-- New Project Modal -->
<div class="modal fade" id="newProjectModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Create New Project</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form action="{{ url_for('main.create_project') }}" method="POST">
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="projectName" class="form-label">Project Name <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="projectName" name="name" required>
                    </div>
                    <div class="mb-3">
                        <label for="projectDescription" class="form-label">Description</label>
                        <textarea class="form-control" id="projectDescription" name="description" rows="3" placeholder="Briefly describe your project..."></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Create Project</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Quick question functionality
function askQuickQuestion() {
    const question = document.getElementById('quickQuestion').value.trim();
    if (!question) return;
    
    // Simulate AI response (in a real implementation, this would be a real AI call)
    const responses = [
        "Based on current research, I recommend checking the molecular weight and lipophilicity for optimal bioavailability.",
        "Consider using excipients like microcrystalline cellulose for tablet formulation. Check the Excipients Library for more details.",
        "For drug discovery, start with molecular analysis to understand the compound's properties and potential interactions.",
        "SMILES notation is a great way to represent molecular structures. Try the Molecular Analysis tool for detailed insights.",
        "Drug-drug interactions often involve CYP450 enzymes. Consider metabolism pathways in your analysis."
    ];
    
    const randomResponse = responses[Math.floor(Math.random() * responses.length)];
    
    document.getElementById('answerText').textContent = randomResponse;
    document.getElementById('quickAnswer').style.display = 'block';
    document.getElementById('quickQuestion').value = '';
}

// Allow Enter key to submit quick question
document.getElementById('quickQuestion').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        askQuickQuestion();
    }
});
</script>
{% endblock %}
